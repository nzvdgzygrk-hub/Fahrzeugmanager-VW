<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>VW Touran Fahrzeugmanager (Erweitert)</title>
  <style>
    :root {
      --vw-blue: #004b87;
      --vw-blue-light: #e3f2fd;
      --vw-grey-bg: #eef2f5;
    }

    body {
      font-family: Arial, sans-serif;
      background: var(--vw-grey-bg);
      padding: 20px;
    }

    .box {
      background: #ffffff;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.08);
      margin-bottom: 28px;
      border-top: 4px solid var(--vw-blue);
    }

    h2 {
      margin-top: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: var(--vw-blue);
    }

    .icon {
      font-size: 22px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #ffffff;
    }

    th, td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #f5f7fa;
      color: #333;
    }

    input, select {
      width: 100%;
      padding: 6px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: inherit;
      font-size: 14px;
    }

    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      background: var(--vw-blue);
      color: white;
      cursor: pointer;
      margin-top: 10px;
      font-size: 14px;
    }

    button:hover {
      background: #003764;
    }

    .smallbtn {
      background: #444;
      padding: 6px 10px;
      font-size: 13px;
      color: white;
    }

    .task-block {
      margin-bottom: 18px;
      padding: 15px;
      background: var(--vw-blue-light);
      border-radius: 10px;
      border: 1px solid #c5d7e8;
    }

    .task-block h3 {
      margin: 0 0 8px 0;
      color: #003764;
      font-size: 16px;
    }

    .task-block small {
      font-weight: normal;
      color: #555;
      font-size: 12px;
    }

    /* Mobile-freundliche Darstellung: alles untereinander */
    .entry-row {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 6px;
      margin-bottom: 10px;
    }

    .entry-row input[type="text"],
    .entry-row input[type="number"],
    .entry-row input[type="date"] {
      width: 100%;
    }

    .entry-row .check-wrap {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .entry-row .check-wrap label {
      font-size: 13px;
    }

    .monthbox {
      padding: 10px;
      background: #f5f5f5;
      border-radius: 10px;
      margin-top: 10px;
      border: 1px solid #ddd;
    }

    ul {
      margin: 0 0 0 18px;
      padding: 0;
    }
  </style>
</head>
<body>

  <!-- Dashboard -->
  <div class="box">
    <h2><span class="icon">üìä</span>√úbersicht (Dashboard)</h2>
    <ul>
      <li><b>T√úV:</b> <span id="dashTuev">‚Äì</span></li>
      <li><b>Letzter √ñlwechsel:</b> <span id="dashOil">‚Äì</span></li>
      <li><b>N√§chster √ñlwechsel:</b> <span id="dashNextOil">‚Äì</span></li>
      <li><b>Letzte Reparaturkosten:</b> <span id="dashLastRepair">‚Äì</span></li>
      <li><b>Letzter Verbrauch:</b> <span id="dashFuel">‚Äì</span></li>
    </ul>
  </div>

  <!-- Fahrzeugdaten -->
  <div class="box">
    <h2><span class="icon">üöó</span>Fahrzeugdaten ‚Äì Volkswagen Touran</h2>
    <label>Marke</label>
    <input id="marke" value="Volkswagen">

    <label>Modell</label>
    <input id="modell" value="Touran 2.0 TDI 110kW">

    <label>Schl√ºsselnummer 2.1</label>
    <input id="hsn" value="4527">

    <label>Schl√ºsselnummer 2.2</label>
    <input id="tsn" value="4632">

    <label>Kennzeichen</label>
    <input id="plate">

    <label>T√úV g√ºltig bis</label>
    <input type="date" id="tuev">

    <button onclick="saveVehicle()">Speichern</button>
  </div>

  <!-- Inspektionsplan (fest) -->
  <div class="box">
    <h2><span class="icon">üõ†Ô∏è</span>VW Inspektionsplan (Fix)</h2>
    <p>Standardarbeiten mit festen Intervallen. H√§kchen = erledigt, Datum wird automatisch gesetzt und in die Wartungshistorie √ºbernommen.</p>
    <div id="inspectionList"></div>
  </div>

  <!-- Wartung manuell -->
  <div class="box">
    <h2><span class="icon">üìã</span>Wartung manuell eintragen</h2>
    <label>Kilometer</label>
    <input id="manKM" type="number">

    <label>Arbeit</label>
    <input id="manTask" type="text" placeholder="z.B. Zahnriemen">

    <label>Kosten (‚Ç¨)</label>
    <input id="manCost" type="number" step="0.01" placeholder="optional">

    <button onclick="addManualWartung()">Wartung speichern</button>
  </div>

  <!-- Wartungshistorie -->
  <div class="box">
    <h2><span class="icon">üìö</span>Wartungshistorie</h2>
    <table>
      <thead>
        <tr><th>Datum</th><th>KM</th><th>Arbeit</th><th>Kosten</th></tr>
      </thead>
      <tbody id="wartungHistory"></tbody>
    </table>
    <button onclick="undoLastHistory()">Letzten Eintrag r√ºckg√§ngig (Passwort)</button>
    <br><br>
    <button onclick="exportWartungText()">Export Wartung (WhatsApp)</button>
  </div>

  <!-- Reparaturkosten pro Monat -->
  <div class="box">
    <h2><span class="icon">üìÖ</span>Reparaturkosten pro Monat</h2>
    <div id="repMonth"></div>
  </div>

  <!-- Tanken -->
  <div class="box">
    <h2><span class="icon">‚õΩ</span>Tanken &amp; Verbrauch</h2>

    <label>Datum</label>
    <input type="date" id="tankDate">

    <label>Kilometer</label>
    <input type="number" id="tankKM">

    <label>Liter</label>
    <input type="number" id="tankL" step="0.01">

    <label>Preis pro Liter (‚Ç¨)</label>
    <input type="number" id="tankP" step="0.001">

    <button onclick="addTank()">Eintragen</button>

    <table>
      <thead>
        <tr><th>Datum</th><th>KM</th><th>Liter</th><th>Preis/L</th><th>Kosten</th><th>Verbrauch (L/100km)</th></tr>
      </thead>
      <tbody id="tankList"></tbody>
    </table>

    <button onclick="exportTankText()">Export Tanken (WhatsApp)</button>
  </div>

  <script>
    //--------------------------------------------------
    // Feste Inspektionsdaten
    //--------------------------------------------------
    const fixedTasks = [
      { id: "oil",   title: "√ñlwechsel",        interval: 30000, preset: [30000, 60000, 90000, 120000] },
      { id: "luft",  title: "Luftfilter",       interval: 90000, preset: [90000, 180000] },
      { id: "innen", title: "Innenraumfilter",  interval: 60000, preset: [60000, 120000] },
      { id: "diesel",title: "Kraftstofffilter", interval: 90000, preset: [90000, 180000] },
      { id: "gear",  title: "Schaltgetriebe√∂l", interval: 60000, preset: [60000, 120000] },
      { id: "brake", title: "Bremsfl√ºssigkeit", interval: "2 Jahre", preset: ["11.01.2023"] }
    ];

    //--------------------------------------------------
    // Inspektionsliste rendern
    //--------------------------------------------------
    function renderInspectionList() {
      const box = document.getElementById("inspectionList");
      box.innerHTML = "";

      fixedTasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task-block";
        div.innerHTML = `<h3>${task.title} <small>(${task.interval})</small></h3>`;

        task.preset.forEach((v, i) => {
          const id = task.id + "_" + i;
          const row = document.createElement("div");
          row.className = "entry-row";
          row.innerHTML = `
            <input id="km_${id}" value="${v}" disabled>
            <input id="dt_${id}" placeholder="Datum">
            <div class="check-wrap">
              <input type="checkbox" id="chk_${id}" onchange="finishInspection('${task.id}', ${v}, '${id}')">
              <label for="chk_${id}">erledigt</label>
            </div>
          `;
          div.appendChild(row);
        });

        box.appendChild(div);
      });
    }

    //--------------------------------------------------
    // Inspektion abgeschlossen ‚Üí in Historie √ºbernehmen
    //--------------------------------------------------
    function finishInspection(taskId, km, id) {
      const checkbox = document.getElementById("chk_" + id);
      if (!checkbox.checked) return;

      const today = new Date().toISOString().split("T")[0];
      document.getElementById("dt_" + id).value = today;
      addHistory(taskId, km, today, 0);
    }

    //--------------------------------------------------
    // Manuelle Wartung
    //--------------------------------------------------
    function addManualWartung() {
      const km   = document.getElementById("manKM").value;
      const task = document.getElementById("manTask").value.trim();
      const cost = document.getElementById("manCost").value;

      if (!km || !task) {
        alert("Bitte Kilometer und Arbeit eintragen!");
        return;
      }

      const today = new Date().toISOString().split("T")[0];
      const costNum = cost ? Number(cost) : 0;
      addHistory(task, km, today, costNum);

      document.getElementById("manKM").value = "";
      document.getElementById("manTask").value = "";
      document.getElementById("manCost").value = "";
    }

    //--------------------------------------------------
    // Wartungshistorie speichern
    //--------------------------------------------------
    function addHistory(task, km, date, cost) {
      const list = JSON.parse(localStorage.getItem("vw_hist") || "[]");
      list.push({ task, km, date, cost });
      localStorage.setItem("vw_hist", JSON.stringify(list));
      renderHistory();
      renderMonthly();
    }

    //--------------------------------------------------
    // Wartungshistorie anzeigen
    //--------------------------------------------------
    function renderHistory() {
      const list = JSON.parse(localStorage.getItem("vw_hist") || "[]");
      list.sort((a, b) => new Date(a.date) - new Date(b.date));

      const tb = document.getElementById("wartungHistory");
      tb.innerHTML = "";

      list.forEach(e => {
        const tr = document.createElement("tr");
        const cost = e.cost ? Number(e.cost).toFixed(2) + " ‚Ç¨" : "";
        tr.innerHTML = `<td>${e.date}</td><td>${e.km}</td><td>${e.task}</td><td>${cost}</td>`;
        tb.appendChild(tr);
      });
    }

    //--------------------------------------------------
    // Letzten Eintrag r√ºckg√§ngig machen (Passwort Fatih)
    //--------------------------------------------------
    function undoLastHistory() {
      const pw = prompt("Passwort?");
      if (pw !== "Fatih") {
        alert("Falsches Passwort.");
        return;
      }

      const list = JSON.parse(localStorage.getItem("vw_hist") || "[]");
      if (list.length === 0) {
        alert("Keine Eintr√§ge vorhanden.");
        return;
      }

      list.pop();
      localStorage.setItem("vw_hist", JSON.stringify(list));
      renderHistory();
      renderMonthly();
    }

    //--------------------------------------------------
    // Monatskosten berechnen
    //--------------------------------------------------
    function renderMonthly() {
      const list = JSON.parse(localStorage.getItem("vw_hist") || "[]");
      const map = {};

      list.forEach(e => {
        const key = e.date ? e.date.slice(0, 7) : ""; // YYYY-MM
        if (!key) return;
        const cost = e.cost ? Number(e.cost) : 0;
        map[key] = (map[key] || 0) + cost;
      });

      const box = document.getElementById("repMonth");
      box.innerHTML = "";

      Object.keys(map).sort().forEach(month => {
        const div = document.createElement("div");
        div.className = "monthbox";
        div.innerHTML = `<b>${month}</b>: ${map[month].toFixed(2)} ‚Ç¨`;
        box.appendChild(div);
      });
    }

    //--------------------------------------------------
    // Tanken
    //--------------------------------------------------
    function addTank() {
      const d = document.getElementById("tankDate").value;
      const km = document.getElementById("tankKM").value;
      const l  = document.getElementById("tankL").value;
      const p  = document.getElementById("tankP").value;

      if (!d || !km || !l || !p) {
        alert("Bitte alle Tankdaten eintragen.");
        return;
      }

      const liters = Number(l);
      const price  = Number(p);
      const dist   = Number(km);
      const cost   = liters * price;
      const verb   = dist > 0 ? (liters / dist) * 100 : 0;

      const list = JSON.parse(localStorage.getItem("vw_tank") || "[]");
      list.push({ d, km: dist, l: liters, p: price, cost, verb });
      localStorage.setItem("vw_tank", JSON.stringify(list));
      renderTank();
    }

    function renderTank() {
      const list = JSON.parse(localStorage.getItem("vw_tank") || "[]");
      const tb = document.getElementById("tankList");
      tb.innerHTML = "";

      list.forEach(e => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${e.d}</td><td>${e.km}</td><td>${e.l.toFixed(2)}</td><td>${e.p.toFixed(3)} ‚Ç¨</td><td>${e.cost.toFixed(2)} ‚Ç¨</td><td>${e.verb.toFixed(2)}</td>`;
        tb.appendChild(tr);
      });
    }

    //--------------------------------------------------
    // WhatsApp-Export (Text in Zwischenablage)
    //--------------------------------------------------
    function exportWartungText() {
      const list = JSON.parse(localStorage.getItem("vw_hist") || "[]");
      let text = "Wartung:
";

      list.forEach(e => {
        const cost = e.cost ? Number(e.cost).toFixed(2) + " ‚Ç¨" : "";
        text += `${e.date} - ${e.km} km - ${e.task} - ${cost}
`;
      });

      navigator.clipboard.writeText(text)
        .then(() => alert("Wartungsdaten kopiert ‚Äì jetzt in WhatsApp einf√ºgen."))
        .catch(() => alert("Konnte nicht in die Zwischenablage kopieren."));
    }

    function exportTankText() {
      const list = JSON.parse(localStorage.getItem("vw_tank") || "[]");
      let text = "Tanken:
";

      list.forEach(e => {
        text += `${e.d} - ${e.km} km - ${e.l.toFixed(2)} L - ${e.cost.toFixed(2)} ‚Ç¨
`;
      });

      navigator.clipboard.writeText(text)
        .then(() => alert("Tankdaten kopiert ‚Äì jetzt in WhatsApp einf√ºgen."))
        .catch(() => alert("Konnte nicht in die Zwischenablage kopieren."));
    }

    //--------------------------------------------------
    // Fahrzeugdaten speichern (localStorage)
    //--------------------------------------------------
    function saveVehicle() {
      const data = {
        marke: document.getElementById("marke").value,
        modell: document.getElementById("modell").value,
        hsn: document.getElementById("hsn").value,
        tsn: document.getElementById("tsn").value,
        plate: document.getElementById("plate").value,
        tuev: document.getElementById("tuev").value
      };
      localStorage.setItem("vw_vehicle", JSON.stringify(data));
      alert("Fahrzeugdaten gespeichert.");
    }

    //--------------------------------------------------
    // Initial laden
    //--------------------------------------------------
    renderInspectionList();
    renderHistory();
    renderMonthly();
    renderTank();
  </script>
</body>
</html>
